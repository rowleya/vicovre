#summary Description of the REST interface for exporting video from ViCo

= Introduction =

This page details the REST interface for exporting video from !ViCo.  This can be to an actual video format e.g. an avi file or an flv file, or it can be via an RTP stream to a unicast or multicast address.

= Details =

|| *HTTP Method* || *URL Format* || *Return Content Types* || *Return Codes* || *Description* ||
|| GET || {{{http://<url>/export/<id>/list}}} || text/xml || 200 (OK) || Gets a description of the streams in the session. ||
|| GET || {{{http://<url>/export/<id>?<file-parameters>}}} || Varies || 200 (OK) || Downloads a file of the session from the server.  The {{{<file-parameters>}}} (see below) determine the content type ||
|| GET || {{{http://<url>/export/<id>/changed[?changeid=<cid>]}}} || text/xml || 200 (OK) || Indicates if a live stream has changed.  If it has, the return will be {{{<changes><changed>true</changed><changeid><cid></changeid></changes>}}}, otherwise it will be {{{<changes><changed>false</changed><changeid><cid></changeid></changes>}}}.  This may block for up to 10 seconds before returning.  This is useful for receiving a live stream via images.  If the change id {{{<cid>}}} is not specified, one will be assigned and returned.  This allows multiple users to determine if the stream has changed for them since the last call to the uri. ||
|| POST || {{{http://<url>/export/<id>?<stream-parameters>}}} || None || 200 (OK), 503 (Unsupported media format) || Sends the session from the server.  The {{{<stream-parameters>}}} (see below) determine what is sent where. ||

== Stream Listing ==
The xml returned for the streams will be as follows:
{{{
<streams>

    // One for each stream
    <stream>

        // The id of the stream
        <id>...</id>
        
        // If the stream is an audio stream:
        <audio>
            
            // The sample rate of the audio in samples per second
            <samplerate>...</samplerate>

            // The sample size of the audio in bits
            <samplesize>...</samplesize>

            // The number of channels of audio contained in the stream
            <channels>...</channels>

        </audio>

        // If the stream is a video stream:
        <video>
            
            // The width of the video in pixels
            <width>...</width>
            
            // The height of the video in pixels
            <height>...</height>

        </video>

    </stream>
    ...
</streams>
}}}

== Requested Content Type ==
The requested content type will specify the type of the file to be downloaded.

== Multiple Streams Support ==
The export can contain multiple audio and video streams.  When multiple audio streams are selected, they will be mixed together using a mixer with automatic gain control.  When multiple video streams are selected, they will be placed in positions specified within a single output video stream.  If only one audio and video stream are selected, no mixing will take place.

== File Parameters ==
The following can be specified as query parameters (i.e. {{{<parameter>=<value>}}}) of the url:
|| *Parameter* || *Description* ||
|| videocodec || Specifies the codec to use for the video streams.  If omitted, a default codec will be selected based on the content type requested. ||
|| audiocodec || Specifies the codec to use for the audio streams.  If omitted, a default codec will be selected based on the content type requested. ||
|| streamid || Specifies that the given stream will be included in the resulting file.   Where multiple streams are specified, the streams will be drawn in this order (so later streams will be drawn over earlier streams where they overlap). ||
|| {{{<streamid>}}}width || Specifies the width to be used for the given stream, assuming the stream is a video stream (otherwise it is ignored).  If {{{<streamid>}}} is omitted, the last streamid specified will be assumed. ||
|| {{{<streamid>}}}height || Specifies the height to be used for the given stream, assuming the stream is an video stream (otherwise it is ignored). If {{{<streamid>}}} is omitted, the last streamid specified will be assumed. ||
|| {{{<streamid>}}}xpos || Specifies the x coordinate of the stream in the output, assuming the stream is an video stream (otherwise it is ignored). If {{{<streamid>}}} is omitted, the last streamid specified will be assumed. ||
|| {{{<streamid>}}}ypos || Specifies the y coordinate of the stream in the output, assuming the stream is an video stream (otherwise it is ignored). If {{{<streamid>}}} is omitted, the last streamid specified will be assumed. ||

== Image Output Format ==
When an image output format is chosen, only video streams will be included in the output.  Audio streams will be ignored.  In a live session, the image will represent the video at the point of the request.  It is recommended that requests of this kind combine with the image change requests to determine when the image has changed sufficiently to be shown to the user.

== Stream Parameters ==