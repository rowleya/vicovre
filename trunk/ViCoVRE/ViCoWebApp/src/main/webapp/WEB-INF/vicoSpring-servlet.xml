<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">

<beans>

    <bean id="viewResolver"
          class="org.springframework.web.servlet.view.InternalResourceViewResolver">
        <property name="viewClass" value="org.springframework.web.servlet.view.JstlView"/>
        <property name="prefix" value="/WEB-INF/jsp/"/>
        <property name="suffix" value=".jsp"/>
    </bean>

    <bean id="rtpTypeRepository" class="com.googlecode.vicovre.repositories.rtptype.impl.RtpTypeRepositoryXmlImpl">
        <constructor-arg><value>/rtptypes.xml</value></constructor-arg>
    </bean>

    <bean id="layoutRepository" class="com.googlecode.vicovre.repositories.layout.impl.LayoutRepositoryXmlImpl">
        <constructor-arg><value>/layouts.xml</value></constructor-arg>
    </bean>

    <bean id="harvestFormatRepository" class="com.googlecode.vicovre.repositories.harvestFormat.impl.HarvestFormatRepositoryXmlImpl">
        <constructor-arg><value>/harvestFormats.xml</value></constructor-arg>
    </bean>

    <bean id="liveAnnotationTypeRepository" class="com.googlecode.vicovre.repositories.liveAnnotation.impl.LiveAnnotationTypeRepositoryXmlImpl">
        <constructor-arg><value>/liveannotations.xml</value></constructor-arg>
    </bean>

    <bean id="database" class="com.googlecode.vicovre.recordings.db.RecordingDatabase" destroy-method="shutdown">
        <constructor-arg><value>${recording.location}</value></constructor-arg>
        <constructor-arg><ref bean="rtpTypeRepository"/></constructor-arg>
        <constructor-arg><ref bean="layoutRepository"/></constructor-arg>
        <constructor-arg><ref bean="harvestFormatRepository"/></constructor-arg>
    </bean>

    <!-- XML-RPC Configuration -->
    <bean id="venueHandler" class="com.googlecode.vicovre.web.xmlrpc.VenueHandler">
        <constructor-arg><ref bean="database"/></constructor-arg>
    </bean>

    <bean id="harvestHandler" class="com.googlecode.vicovre.web.xmlrpc.HarvestHandler">
        <constructor-arg><ref bean="database"/></constructor-arg>
        <constructor-arg><ref bean="harvestFormatRepository"/></constructor-arg>
        <constructor-arg><ref bean="rtpTypeRepository"/></constructor-arg>
    </bean>

    <bean id="unfinishedRecordingHandler" class="com.googlecode.vicovre.web.xmlrpc.UnfinishedRecordingHandler">
        <constructor-arg><ref bean="database"/></constructor-arg>
        <constructor-arg><ref bean="rtpTypeRepository"/></constructor-arg>
    </bean>

    <bean id="recordingHandler" class="com.googlecode.vicovre.web.xmlrpc.RecordingHandler">
        <constructor-arg><ref bean="database"/></constructor-arg>
    </bean>

    <bean id="playbackHandler" class="com.googlecode.vicovre.web.xmlrpc.PlayToVenueHandler">
        <constructor-arg><ref bean="database"/></constructor-arg>
    </bean>

    <bean id="layoutHandler" class="com.googlecode.vicovre.web.xmlrpc.LayoutHandler">
        <constructor-arg><ref bean="database"/></constructor-arg>
        <constructor-arg><ref bean="layoutRepository"/></constructor-arg>
        <constructor-arg><ref bean="rtpTypeRepository"/></constructor-arg>
    </bean>

    <bean id="xmlRpcHandlerMapping" class="com.googlecode.vicovre.web.xmlrpc.SimpleHandlerMapping">
        <constructor-arg>
            <map>
                <entry key="venue" value-ref="venueHandler"/>
                <entry key="harvest" value-ref="harvestHandler"/>
                <entry key="unfinishedRecording" value-ref="unfinishedRecordingHandler"/>
                <entry key="recording" value-ref="recordingHandler"/>
                <entry key="playback" value-ref="playbackHandler"/>
                <entry key="layout" value-ref="layoutHandler"/>
            </map>
        </constructor-arg>
    </bean>

    <!-- Annotations implementation - comment out to ignore annotations -->
    <bean id="profileRepository" class="org.caboto.profile.ProfileRepositoryXmlImpl">
        <constructor-arg index="0" value="profiles.xml"/>
    </bean>

    <bean id="cabotoDatabase" class="org.caboto.jena.db.impl.SDBDatabase">
        <constructor-arg index="0" value="caboto.db"/>
        <constructor-arg index="1" value="/caboto.properties"/>
    </bean>

    <bean id="annotationDao" class="org.caboto.dao.AnnotationDaoImpl">
        <constructor-arg index="0" ref="profileRepository"/>
        <constructor-arg index="1" ref="cabotoDatabase"/>
    </bean>

    <bean name="/xmlrpc.do" class="com.googlecode.vicovre.web.xmlrpc.XmlRpcController">
        <constructor-arg><ref bean="xmlRpcHandlerMapping"/></constructor-arg>
    </bean>
    <bean name="/play.do" class="com.googlecode.vicovre.web.play.PlayRecordingController">
        <constructor-arg><ref bean="database"/></constructor-arg>
        <constructor-arg><ref bean="layoutRepository"/></constructor-arg>
        <constructor-arg><ref bean="liveAnnotationTypeRepository"/></constructor-arg>
        <!-- Comment out the following lines to ignore annotations -->
        <constructor-arg><ref bean="annotationDao"/></constructor-arg>
        <constructor-arg><value>${recording.prefix}</value></constructor-arg>
    </bean>
    <bean name="/flv.do" class="com.googlecode.vicovre.web.play.FlvController">
        <constructor-arg><ref bean="database"/></constructor-arg>
        <constructor-arg><ref bean="rtpTypeRepository"/></constructor-arg>
    </bean>
    <bean name="/image.do" class="com.googlecode.vicovre.web.play.ImageController">
        <constructor-arg><ref bean="database"/></constructor-arg>
    </bean>
    <bean name="/**/listRecordings.do" class="com.googlecode.vicovre.web.play.ListRecordingsController">
        <constructor-arg><ref bean="database"/></constructor-arg>
    </bean>
    <bean name="/**/displayRecording.do" class="com.googlecode.vicovre.web.play.DisplayRecordingController">
        <constructor-arg><ref bean="database"/></constructor-arg>
        <constructor-arg><ref bean="layoutRepository"/></constructor-arg>
        <!-- Comment out the following lines to ignore annotations -->
        <constructor-arg><ref bean="annotationDao"/></constructor-arg>
        <constructor-arg><value>${recording.prefix}</value></constructor-arg>
    </bean>
</beans>